# 스위치의 구조 및 동작

## 스위치

- 네트워크 중간에서 **패킷을 받아 필요한 곳에만 보내주는** 네트워크 중재자 역할이다.
- 패킷을 동시에 **여러 장비가 서로의 간섭 없이** 통신하도록 한다.
- 데이터 링크 계층에서 동작하고 **레이어 2 스위치** 또는 **스위칭 허브**라고 불린다.
- 스위치 내부에는 **MAC주소 테이블**이 있다.
- MAC주소 테이블(bridge table)은 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터 베이스이다.
- MAC 테이블은 일정 시간 동안 지워지지 않는데 이 시간을 **에이징 타임(Aging Time)**
- 아무 설정 없이 네트워크에 연결해도  MAC주소 기반으로 패킷을 전달하는 기본 동작을 수행한다.
- **핵심역할은 누가 어느 위치에 있는지 파악하고 패킷을 알고있는 위치로 정확하게 전송하는것**

## MAC 주소 학습 기능 - 어드레서 러닝

1. 스위치의 부팅 시 MAC주소 테이블에 아무것도 등록되어있지 않음
    1. 네트워크 통신 중재 역할을 하지 못하고 허브처럼 동작
2. 컴퓨터에서 목적지 MAC주소가 추가된 프레임이 전송
3. MAC주소 테이블을 확인
4. 출발지 MAC주소가 등록되어 있지 않으면 MAC주소 포트와 함께 등록

## 플러딩 (flooding)

5-1. 목적지 MAC주소가 MAC주소 테이블에 등록되어있지 않다면 목적지 이외의 포트에도 프레임(데이터)가 전송

## MAC주소 포워딩

5-2. 목적지 MAC주소가 MAC주소 테이블에 등록되어있다면 MAC주소를 기준으로 해당 목적지 포트로 데이터를 보낸다. (포워딩한다)

## MAC주소 필터링

다른 포트들로 **불필요한 데이터를 네트워크에 전송하지 않게된다.**

## 결론

스위치는 이런 포워딩과 필터링을 통해 목적지로만 패킷이 전달되도록 동작합니다.

스위치에서는 포워딩과 필터링 작업이 여러 포트에서 동시에 수행될 수 있습니다. 

통신이 다른 포트에 영향을 미치지 않으므로 다른 포트에서 기존 통신 작업으로부터 독립적으로 동작할 수 있습니다.

## 사전에 정의된 MAC주소 테이블

- 학습한 MAC주소 정보 외에 **미리 사전에 정의된 MAC주소 정보**가 있다
- 이런 사전의 정의된 주소는 데이터를 처리하기 위한 주소가 아니라 **스위치간 통신을 위해 사용**되는 주소다.
- 특정 포트로 내보내는것이 아닌 **스위치 자체에서 처리**
- 인접 포트 정보가 없거나 CPU 혹은 관리 모듈을 지칭하는 용어로 표기

## ARP

ARP (Address Resolution Protocol) 는 목적지 **컴퓨터의 IP 주소를 이용**하여 **MAC주소를 찾기** 위한 **프로토콜**이다.

- ARP 요청(request)
    
    출발지 컴퓨터가 목적지 주소를 모르면 MAC주소를 알아내기 위해 네트워크에 브로드캐스트를 함
    
- ARP 응답(reply)
    
    지정된 IP주소를 가진 컴퓨터만 MAC주소를 응답으로 보낸다
    
    이 과정으로 출발지 컴퓨터는 목적지 MAC주소를 얻어 이더넷 프레임을 만든다.
    
- ARP 테이블(table)
    
    출발지 컴퓨터는 MAC주소를 얻은 후에 MAC주소와 IP주소의 매핑 정보를 메모리에 보관한다.
    
    이 후 데이터 통신은 자신의 컴퓨터에 보관된 ARP 테이블을 참고하여 전송한다.
    
- ARP 캐시
    
    But, IP주소가 변경되는 경우 때문에 ARP 테이블에서는 보존 기간()을 ARP 캐시로 지정하고 일정 기간 시간이 지나면 삭제하고 다시 ARP요청을 한다.
    
    cf ) 보존 기간 - 에이징 타임(Aging Time)
    
